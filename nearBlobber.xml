<?xml version="1.0" encoding="ISO-8859-1"?>
<?xml-stylesheet type="text/xsl" href="yarpmanifest.xsl"?>
 
<module>
    <!-- module's name should match its executable file's name. -->
    <name>nearBlobber</name>
    <description> Uses disparity to find closest object</description>
        <copypolicy>Released under the terms of the GNU GPL v2.0</copypolicy>
    <version>1.1</version>
    
    <description-long>
    This module takes as an input a disparity/depth image and outputs the closest blob, both as a
    binary image as well as the blob overimposed in green to the original depth image, and the blob 
    center's coordinates        
     
    </description-long>

    <!-- <arguments> can have multiple <param> tags-->
    <arguments>    
    <param desc="Name of the module" default="nearBlobber"> name</param>
    <param desc="Robot used" default="icub"> robot</param>
    <param desc="Verbose" default="false"> verbose</param>
    <param desc="Bounding Box Margin" default=20> margin</param>   
    <param desc="Background Threshold" default=50> backgroundThresh</param>   
    <param desc="Max Luminance Threshold" default=190> frontThresh</param>   
    <param desc="Canny Edge detector Threshold" default=20> cannyThresh</param>   
    <param desc="Minimum blob size" default=400> minBlobSize</param>   
    <param desc="Gaussian blur size" default=5> gaussSize</param>   
    <param desc="Gaussian blur size" default=5> gaussSize</param>  
    <param desc="Max luminance ratio within blob, below avg lum." default=10> dispThreshRatioLow</param>      
    <param desc="Max luminance ratio within blob, over avg lum. " default=20> dispThreshRatioHigh</param>      
    </arguments>

    <!-- <authors> can have multiple <author> tags. -->
    <authors>
	  <author email="tanis.mar@iit.it"> Tanis Mar</author>
    </authors>

     <!-- <data> can have multiple <input> or <output> tags. -->
     <data>
        <!-- input data if available -->
        <input type="service">
            <type>rpc</type>
            <port carrier="tcp">/nearBlobber/rpc:i</port>
            <description> Takes the following RPC commands from Human or stateMachine
            
                -# <b>margin</b> <i>(int) margin</i>: sets the margin (in pixels) that the ROI keeps around the closest blob.")
                -# <b>thresh</b> <i>(int) high (int) low </i>: sets higher and lower limit of disparity in terms of luminosity (0-255) that is considered. In other words, objects with luminosity outside boundaries wont be considered.
                -# <b>verbose</b> <i>(string) ON/OFF</i>: Sets active the printouts of the program, for debugging or visualization. 
                -# <b>help</b> - produces this help.;
                -# <b>quit</b> - closes the module.;                
            </description>
        </input>
        
        <input>
            <type>ImageOfPixelMono</type>
            <port carrier="udp">/nearBlobber/disp:i</port>
            <required>no</required>
            <priority>no</priority>
            <description>StereoDisparity disparity image</description>
        </input>
 
        
        <!-- output data if available -->
        <output>
            <type>ImageOfPixelBgr</type>
            <port carrier="udp">/nearBlobber/img:o</port>
            <description> Identifies the closest blob and its center and bounding box superposed on the disparity image</description>
        </output>
        <output>
            <type>Bottle</type>
            <port carrier="tcp">/nearBlobber/target:o</port>
            <description> Coordinates tl-br of the bounding box + margin around the closest blob</description>
        </output>
        <output>
            <type>ImageOfPixelMono</type>
            <port carrier="udp">/nearBlobber/imgBin:o</port>
            <description> Send out the binary image of selected blob</description>
        </output>
    </data>

    <dependencies>
        <computer>
        </computer>
    </dependencies>

    <!-- specific libraries or header files which are used for development -->
    <development>
        <header></header>
        <library>YARP</library>
        <library>stereoVision</library>
        <library>OpenCV</library>
    </development>

</module>

